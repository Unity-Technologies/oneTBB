all:
    name: Build tbb for Windows
    agent:
        type: Unity::VM
        image: desktop/desktop-vs2019:v0.1.0-542248
        flavor: b1.small
    commands:
        - cmake -DCMAKE_MSVC_RUNTIME_LIBRARY=MultiThreadedDLL
        - cmake --build . --target tbb --target tbbmalloc --config RelWithDebInfo
        - external\7z\7za.exe a -t7z -m0=lzma2 msvc_19.25_cxx_64_md_relwithdebinfo\builds.7z .\msvc_19.25_cxx_64_md_relwithdebinfo\tbb12.dll .\msvc_19.25_cxx_64_md_relwithdebinfo\tbb12.pdb .\msvc_19.25_cxx_64_md_relwithdebinfo\tbbmalloc.dll .\msvc_19.25_cxx_64_md_relwithdebinfo\tbbmalloc.pdb
    artifacts:
        builds:
            paths:
                - msvc_19.25_cxx_64_md_relwithdebinfo\builds.7z